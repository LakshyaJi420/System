<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Focus Lock Pro</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0a0a0a;
      color: #ffffff;
      text-align: center;
      padding: 30px;
      overflow-x: hidden;
      overflow-y: auto;
    }
    input, button, textarea {
      padding: 12px;
      margin: 8px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
    }
    .lockscreen {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: black;
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      z-index: 99999;
      pointer-events: all;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>

<h1>Focus Lock Pro</h1>

<div id="setup">
  <p>Set Job and Lock Time:</p>
  <input type="text" id="jobName" placeholder="Job Name (e.g., Lunch)"><br>
  <textarea id="jobAnswer" placeholder="Expected answer after job (e.g., I ate lunch properly)" rows="3" cols="30"></textarea><br>
  <input type="time" id="startTime"> to 
  <input type="time" id="endTime"><br>
  <button onclick="startLock()">Start Lock</button>
</div>

<div id="lockscreen" class="lockscreen hidden">
  <div>
    <p id="lockMessage">Phone is Locked...</p>
    <input type="password" id="bypassInput" placeholder="Enter Secret Code">
    <button onclick="bypassLock()">Unlock</button>
  </div>
</div>

<div id="verification" class="hidden">
  <h2>Verification</h2>
  <p id="verifyJobName"></p>
  <p>What did you do?</p>
  <textarea id="taskInput" rows="4" cols="40" placeholder="Type your answer..."></textarea><br>
  <button onclick="submitTask()">Submit Answer</button>
</div>

<script>
let lockActive = false;
let bypassCode = "Kirmada";
let expectedAnswer = "";
let jobName = "";

function startLock() {
  jobName = document.getElementById('jobName').value.trim();
  expectedAnswer = document.getElementById('jobAnswer').value.trim();
  const start = document.getElementById('startTime').value;
  const end = document.getElementById('endTime').value;

  if (!start || !end || !jobName || !expectedAnswer) {
    alert("Please fill all fields!");
    return;
  }

  const now = new Date();
  const startTime = new Date(now.toDateString() + " " + start);
  const endTime = new Date(now.toDateString() + " " + end);

  if (now >= startTime && now <= endTime) {
    activateLock();
  } else if (now < startTime) {
    const timeToStart = startTime - now;
    setTimeout(activateLock, timeToStart);
    alert(`Lock will start at ${start}`);
  } else {
    alert("End time already passed. Set a valid future time.");
  }
}

function activateLock() {
  document.getElementById('lockscreen').classList.remove('hidden');
  lockActive = true;
  preventExit();
  checkLock();
}

function preventExit() {
  document.body.style.overflow = 'hidden';
  document.addEventListener('keydown', function(e) {
    e.preventDefault();
  }, { passive: false });
}

function checkLock() {
  if (!lockActive) return;

  const now = new Date();
  const end = document.getElementById('endTime').value;
  const endTime = new Date(now.toDateString() + " " + end);

  if (now >= endTime) {
    lockActive = false;
    document.getElementById('lockscreen').classList.add('hidden');
    showVerification();
  } else {
    setTimeout(checkLock, 1000);
  }
}

function bypassLock() {
  const input = document.getElementById('bypassInput').value;
  if (input === bypassCode) {
    lockActive = false;
    document.getElementById('lockscreen').classList.add('hidden');
    showVerification();
    alert("Bypass Successful for Testing");
  } else {
    alert("Wrong Code!");
  }
}

function showVerification() {
  document.getElementById('setup').style.display = 'none';
  document.getElementById('verification').classList.remove('hidden');
  document.getElementById('verifyJobName').innerText = "Job: " + jobName;
}

function submitTask() {
  const userInput = document.getElementById('taskInput').value.trim();
  if (userInput.length < 5) {
    alert("Please write more about what you did!");
    return;
  }
  const similarity = stringSimilarity(expectedAnswer, userInput);
  if (similarity >= 0.7) {
    alert("Good job! Task Verified!");
    location.reload(); // Reset app
  } else {
    alert(`Answer not matched enough (${Math.round(similarity*100)}%). Please try again.`);
  }
}

// Simple string similarity function (percentage of matching words)
function stringSimilarity(str1, str2) {
  const words1 = str1.toLowerCase().split(/\s+/);
  const words2 = str2.toLowerCase().split(/\s+/);
  let matches = 0;
  words1.forEach(word => {
    if (words2.includes(word)) matches++;
  });
  return matches / Math.max(words1.length, words2.length);
}
</script>

</body>
</html>
